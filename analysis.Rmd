---
title: Analysis
author: "Jingyi Yao"
date: "`r Sys.Date()`"
output: github_document
---

```{r,message=FALSE,warning=FALSE}
library(tidyverse)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


\ \par
```{r,message=FALSE}
data = read_csv("./data/Merged_expectation.csv")

```



\ \par
## 1. Life Expectancy by Year (2000 - 2016)
```{r}
data %>% 
  janitor::clean_names() %>% 
  group_by(year) %>% 
  summarise(avg_by_year = mean(life_expect,na.rm = T)) %>% 
  arrange(avg_by_year) %>% 
  knitr::kable(digits = 3)


data %>% 
  janitor::clean_names() %>% 
  group_by(year)  %>% 
  ggplot(aes(x = factor(year),y = life_expect,fill = year)) +
  geom_boxplot() +
  labs(title = "Boxplot of Life Expectancy by Year") +
  xlab("Year") +
  ylab("Life Expectancy")

```


\ \par
## 2.  Life Expectation by Regions
```{r}
data %>% 
  janitor::clean_names() %>% 
  group_by(region) %>% 
  summarise(avg_by_region = mean(life_expect,na.rm = T)) %>% 
  arrange(avg_by_region) %>% 
  knitr::kable(digits = 3)

data %>% 
  janitor::clean_names() %>% 
  group_by(region) %>% 
  ggplot(aes(x = region, y = life_expect, fill = region)) +
  geom_boxplot() +
  labs(title = "Boxplot of Life Expectancy by Regions") +
  xlab("Region") +
  ylab("Life Expectancy")
  
          
           
```


\ \par
## 3. Average Life Expectancy by (region, year) Combination

```{r}
data %>% 
  janitor::clean_names() %>% 
  group_by(region,year) %>% 
  summarise(avg_by_year_region = mean(life_expect,na.rm = T)) %>% 
  pivot_wider(
    names_from = region,
    values_from = avg_by_year_region
  ) %>% 
  knitr::kable(digits = 3)


```


\ \par
## 4. Average Life Expectancy by Income Level

```{r}
data %>% 
  janitor::clean_names() %>% 
  group_by(income_group) %>% 
  summarise(avg_by_income = mean(life_expect,na.rm = T)) %>% 
  knitr::kable(digits = 3)

data %>% 
  janitor::clean_names() %>% 
  group_by(income_group) %>% 
  ggplot(aes(x = income_group, y = life_expect,fill = income_group)) +
  geom_boxplot() +
  labs(title = "Boxplot of Life Expectancy by Income Groups") +
  xlab("Income Groups") +
  ylab("Life Expectancy")
  

```


\ \par
## 5. Life Expectancy by Development Status

```{r}
data %>% 
  janitor::clean_names() %>% 
  group_by(developed_developing_countries) %>% 
  summarise(avg_by_dev = mean(life_expect,na.rm = T)) %>% 
  knitr::kable(digits = 3)


data %>% 
  janitor::clean_names() %>% 
  group_by(developed_developing_countries) %>% 
  ggplot(aes(x = developed_developing_countries, y = life_expect,fill = developed_developing_countries)) +
  geom_boxplot() +
  labs(title = "Boxplot of Life Expectancy by Development Status") +
  xlab("Development Status") +
  ylab("Life Expectancy")

```



\ \par
## 6. ANOVA : Test Difference in Mean Life Expectancy Among Regions

```{r}
anova_result_1 <- aov(life_expect ~ factor(region), data = data)

broom::tidy(anova_result_1) %>% 
  knitr::kable()


```


\ \par
## 7. Multiple Comparison : Find the Difference Among Regions

### Bonferroni's Method
```{r}
bonferroni_result <- pairwise.t.test(data$life_expect, data$region, p.adj = 'bonferroni')

broom::tidy(bonferroni_result) %>% 
    knitr::kable()

```


\ \par
### Tukey's Method
```{r}
tukey_result <- TukeyHSD(anova_result_1)

plot(tukey_result)

```


\ \par
## 8. ANOVA : Test Difference in Mean Life Expectancy Among Income Levels

```{r}
anova_result_2 <- aov(life_expect ~ factor(income_group),data = data)

broom::tidy(anova_result_2) %>% 
  knitr::kable()

```

\ \par
## 9. Multiple Comparison : Find the Difference Among Income Levels

### Bonferroni's Method
```{r}
bonferroni_result <- pairwise.t.test(data$life_expect, data$income_group, p.adj = 'bonferroni')

broom::tidy(bonferroni_result) %>% 
    knitr::kable()

```

\ \par
### Tukey's Method
```{r}
tukey_result <- TukeyHSD(anova_result_2)

plot(tukey_result)

```


\ \par
## 10. t.test : Comapre Mean Life Expectancy Between Developed and Developing Countries

#### extract developed and developing life expectancy
```{r}
developing <- data %>% 
  janitor::clean_names() %>% 
  filter(developed_developing_countries == "Developing") %>% 
  pull(life_expect)


developed <- data %>% 
  janitor::clean_names() %>% 
  filter(developed_developing_countries == "Developed") %>% 
  pull(life_expect) 

```


#### test equal variance
```{r}
var.test(developing,developed,alternative = "two.sided",conf.level = 0.95) %>% 
  broom::tidy() %>% 
  knitr::kable()

```


#### t.test with unknown unequal variances

```{r}
t.test(developing,developed,alternative = "less",conf.level = 0.95,paired = F,var.equal = FALSE ) %>% 
  broom::tidy() %>% 
  knitr::kable()

```




