---
title: "Project report"
date: "2022-11-23"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: cosmo
---
# World Life Expectancyâ€”Live to thrive

## Motivation

## Related work

## Initial questions

### new questions

## Data

### Explore the Original Dataset and look for other reasonable variables

Our main datasets is WHO Life Exp Dataset, which covers the years 2000-2016 for 183 countries, including 32 variables.

While looking at the mortality rate columns in our life expectancy dataset, we found out that the mortality rate has been divided into several age groups--adults, infants, and children with age 1-4. In the meantime, life expectancy has also been divided into two directions--one is the overall countrywide life expectancy, and another one is the life expectancy for people who are older than 60 years old.

Based on this information, we started to wonder whether the causes of death vary at different ages. Under the idea of stratify analysis, we looked into the causes of death in three different age groups. 

The death of infants and young children is largely related to the level of medical care, sanitary conditions, the mother's level of education, the physical and psychological conditions of the mother during childbirth, the support from the country, and so on.

The causes of death of young and middle-aged people are related to social development, employment pressure, work fatigue, environmental pollution, over use of tobacco and alcohol, obesity and other problems. Noncommunicable disease is now the leading cause of death worldwide, and according to WHO, cardiovascular diseases, cancer, chronic respiratory diseases, and diabetes account for the most NCD deaths. These deaths can be attributed to tobacco use, physical inactivity, alcohol, and unhealthy diets. For instance, heart-related diseases, alcohol abuse in young people could be linked. We think these NCDs are very much associated with young adult deaths, since excessive smoking and alcohol addiction, bad diet, tend to occur in young and middle-aged people.

In the end, the death of the elderly may be related to the level of medical care, social welfare, social culture, clean resources, and so on. In addition to the diseases caused by normal aging and cancer, which cannot be cured by the current medical level, the life expectancy of the elderly may be related to whether the hospital is close to them, whether they can afford the medical expenses, whether they have children to take care of them, whether the social welfare is complete, and whether the policies and public facilities are friendly to the elderly.

Based on these ideas, we looked through several papers to generate more variables that we thought would relate to life expectancy.

### Data sources 

* 1. who_life_exp.csv, WHO Life Expectancy Dataset, from [kaggle](https://www.kaggle.com/datasets/mmattson/who-national-life-expectancy).

* 2. country-codes.csv, Country Code Dataset, from [github](https://github.com/datasets/country-codes).

* 3. pm2.5.csv, WHO Pm2.5 Dataset, from [the world bank](https://data.worldbank.org/indicator/EN.ATM.PM25.MC.M3).

* 4. income_level.csv, Income Level Dataset, from [website].

* 5. around_2019_women_percent_in_national_parliaments.csv, Percent of Women in National Parliaments before 2019 Dataset, from [global data on national parliaments](https://data.ipu.org/women-ranking?month=1&year=2019).

* 6. government_compulsory_health expenditure_from_1970_2020.csv, Government Health Expenditure Dataset, from [our world in data](https://ourworldindata.org/grapher/public-health-expenditure-share-gdp-owid?country=SWE~FRA~DEU~JPN~GBR~BEL~ESP~AUS~NZL~CAN~USA).

### Data cleaing 

## Exploratory Analysis
\ \par
### World Life Expectancy and Interactive World Map
\ \par
We designed a shiny app to display several variables' distribution around the world on an interactive world map. The variables include life expectancy, adult mortality rate, infant mortality rate, alcohol consumption level, Body Mass Index (BMI) and Current Health Expenditure (CHE). 

Each variable has a link on the navigation bar that will direct you to its separate page. There is a sidebar on each page which is designed to choose the specific year that you are interested in. Two tabs are set in each page. 

The left tab is the interactive world map. It displays the variable's value of each country in the world. You may zoom in to examine the detailed annotations of each country's data. And you may zoom out to grasp the overall distribution of this variable across countries.

The right tab is the description of the map. We chose the year of 2015 as an example to provide interpretation of each variable. This example works as an instruction for the interactive world map, meaning that users can interpret the variables in other years in similar ways.

You may have access to our shiny app by clicking on the link at the navigation bar or click [here](https://7lx8uo-txbrook.shinyapps.io/map_dashboard/#section-bmi)

We also attached our source code to the app. If you are interested in how we built the map using dashboard and shiny, you may click on the button on the top right corner.



## Additional analysis
\ \par

### Statistical Analysis


```{r,message=FALSE,warning=FALSE,include=FALSE}
library(tidyverse)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

```{r,message=FALSE,include = FALSE}
data = read_csv("./data/Merged_expectation.csv")

```



\ \par
### 1.  Life Expectation by Regions

```{r}
data %>% 
  janitor::clean_names() %>% 
  group_by(region) %>% 
  summarise(avg_by_region = mean(une_life,na.rm = T)) %>% 
  arrange(avg_by_region) %>% 
  knitr::kable(digits = 3)
```

\ \par

  * The table shows the arranged average life expectancy of each region from 2000 to 2016. 
  
  * The range of average life expectancy among regions is about 8 years. 
  
  * Europe has the highest average life expectancy while Africa has the lowest.


\ \par
```{r}
data %>% 
  janitor::clean_names() %>% 
  group_by(region) %>% 
  ggplot(aes(x = fct_reorder(region,une_life), y = une_life, fill = region)) +
  geom_boxplot() +
  labs(title = "Boxplot of Life Expectancy by Regions") +
  xlab("Region") +
  ylab("Life Expectancy") + 
  theme(axis.text.x = element_text(hjust = 1, angle = 10,size = 8))
  
        
```

\ \par

  * The boxplot shows the distribution of life expectancy in each region.
  
  * The variance of life expectancy is higher in Eastern Mediterranean and Africa.
  
  * The Americas has many outliers with low life expectancy
  
  * We can roughly tell from the plot that the variances of life expectancy among regions are not equal. Thus, we may perform a statistical test to check heteroscedasticity



\ \par
#### test of equal variances
```{r}
bartlett.test(une_life ~ factor(region),data = data) %>% 
  broom::tidy() %>% 
  knitr::kable()

```

\ \par
$$H_0:  Equal\ \ variance \ \ among\ \ regions \ \text { vs } \ H_1: Unequal\ \ variance $$

\ \par
The null hypothesis for Bartlett test is that the variances are equal. The
result shows that the p-value is less than 0.05. Thus, we may reject the null and conclude that the variances of life expectancy among different regions is not equal.
Consequently, we cannot perform ANOVA to test the difference of mean life expectancy in all the six regions. We should perform t.test between two selected regions separately.




\ \par
### 2. t.test : Compare Mean Life Expectancy Between Americas and Europe

\ \par
From the boxplot above, we find that the life expectancy in Americas and Europe distribute almost in the same interval. Though the median of Europe is higher, the variance in Americas seems smaller. Thus, we want to study if the mean life expectancy in the two regions are significantly different.


\ \par
#### extract life expectancy in Americas and Europe
```{r}
Americas <- data %>% 
  janitor::clean_names() %>% 
  filter(region == "Americas") %>% 
  pull(une_life)


Europe <- data %>% 
  janitor::clean_names() %>% 
  filter(region == "Europe") %>% 
  pull(une_life) 

```


\ \par

In order to decide on which type of t.test we should perform, we need to compare the variance in Americas and Europe first. 

We can roughly tell from the boxplot that Americas has a smaller variance. But there also exist many outliers with low life expectancy values in Americas. Thus, we turn to statistical test to decide on the relationship.

\ \par
#### test equal variance
```{r}
var.test(Americas,Europe,alternative = "two.sided",conf.level = 0.95) %>% 
  broom::tidy() %>% 
  knitr::kable()

```

\ \par
$$H_0:  \sigma^2_{Americas} =\  \sigma^2_{Europe}\ \text { vs } \ H_1: \sigma^2_{Americas} \neq\  \sigma^2_{Europe} $$

\ \par
The null hypothesis for the variance test is that the two variance are equal. The result shows that the p-value is much less than 0.05. Thus, we may reject the null hypothesis and conclude that the variances are not equal. Next, we should perform 2 sample t.test with unknown and unequal variance.


\ \par
#### 2 sample t.test with unknown unequal variances

```{r}
t.test(Americas,Europe,alternative = "less",conf.level = 0.95,paired = F,var.equal = FALSE ) %>% 
  broom::tidy() %>% 
  knitr::kable()

```

\ \par
$$H_0:  \text{mean life_exp}_{Americas} = \ \text{mean life_exp}_{Europe}\ \text { vs } \ H_1: \text{mean life_exp}_{Americas} \neq \text{mean life_exp}_{Europe} $$

\ \par
The null hypothesis for the t.test is that the two variance are equal. The result shows that the p-value is much less than 0.05. Thus, we may reject the null hypothesis and conclude that the mean of life expectancy in Americas and Europe are different. Since the test statistics is negative, we know that mean life expectancy in Americas is smaller than Europe. 



\ \par
### 3. prop.test : Compare the Proportion of Life Expectancy Over 70 Between Western Pacific and South-East Asia


\ \par
We can tell from the boxplot above that the boxes of Western Pacific and South-East Asia are almost overlapping. The majority of them seem to be over 65 years. Thus we are interested in comparing the proportion of life expectancy over 65 year in the two regions.


```{r}
data %>% 
  janitor::clean_names() %>% 
  filter(region == "Western Pacific") %>% 
  summarise(above_65 = sum(une_life > 65),
            total = n()) %>% 
  knitr::kable()


data %>% 
  janitor::clean_names() %>% 
  filter(region == "South-East Asia")  %>% 
  summarise(above_65 = sum(une_life > 65),
            total = n()) %>% 
  knitr::kable()

prop.test(c(304,149),n = c(357,187),correct = F) %>% 
  broom::tidy() %>% 
  knitr::kable()

```


\ \par
$$H_0:  \text{Proportion}_{Western\ Pacific} = \ \text{Proportion}_{South-East\ Asia}\ \text { vs } \ H_1: \text{mean life_exp}_{Western\ Pacific} \neq \text{mean life_exp}_{South-East\ Asia} $$

\ \par
The null hypothesis for the prop.test is that the two proportions are equal. The result shows that the p-value is approximately 0.104. Thus, under the significance level of 0.05, we fail to reject the null. We have evidence that the proportion of life expectancy above 65 in Western Pacific is the same as in South-East Asia.



\ \par
### 4. Average Life Expectancy by (region, year) Combination

```{r,message=FALSE}
data %>% 
  janitor::clean_names() %>% 
  group_by(region,year) %>% 
  summarise(avg_by_year_region = mean(une_life,na.rm = T)) %>% 
  pivot_wider(
    names_from = region,
    values_from = avg_by_year_region
  ) %>% 
  knitr::kable(digits = 3)


```

```{r,message=FALSE}
data %>% 
  janitor::clean_names() %>% 
  group_by(region,year) %>% 
  summarise(avg_by_year_region = mean(une_life,na.rm = T)) %>% 
  ggplot(aes(x = year, y = avg_by_year_region, color = region)) +
  geom_line() + geom_point() + labs(title = "Average Life Expectancy by Region, Year") + ylab ("Average Life Expectancy")


```


\ \par

  * The table and line graph above show the descriptive statistics and overall trend.
  * It is clearly shown in the plot that Africa has a much lower life expectancy than the other regions.


\ \par
### 5. Life Expectancy by Income Level

```{r}
data %>% 
  janitor::clean_names()  %>% 
  filter(!is.na(income_group)) %>%  
  group_by(income_group) %>% 
  summarise(avg_by_income = mean(une_life,na.rm = T)) %>% 
  arrange(avg_by_income) %>% 
  knitr::kable(digits = 3)

data %>% 
  janitor::clean_names() %>% 
  filter(!is.na(income_group)) %>% 
  group_by(income_group) %>% 
  ggplot(aes(x = fct_reorder(income_group,une_life), y = une_life,fill = income_group)) +
  geom_boxplot() +
  labs(title = "Boxplot of Life Expectancy by Income Groups") +
  xlab("Income Groups") +
  ylab("Life Expectancy")
  

```

\ \par

  * The boxes of different income groups are almost not overlapping with each other. 
  * The pattern is clear that people from higher income group tend to have a higher life expectancy.
  

$$H_0:  \sigma^2_{group \ i} =\  \sigma^2_{group \ j}\ \text { vs } \ H_1: \sigma^2_{group\ i} \neq\  \sigma^2_{group\ j} $$
 
 
  * We have performed variance tests and conclude that the variances are not equal between any two groups. Since the method is similar to what we have used and displayed when studying the regional differences, we do not show the process here.
  
  \ \par
$$H_0:  \text{mean life_exp}_{group \ i} = \ \text{mean life_exp}_{group \ j}\ \text { vs } \ H_1: \text{mean life_exp}_{group \ i} \neq \text{mean life_exp}_{group\ j} $$
  
  * We have also performed 2 sample t.test to compare the mean life expectancy between groups. We conclude that the means are not equal between any two groups. Since the method is similar to what we have used and displayed when studying the regional differences, we do not show the process here.



\ \par
### 6. Life Expectancy by Development Status

```{r}
data %>% 
  janitor::clean_names() %>% 
  group_by(developed_developing_countries) %>% 
  summarise(avg_by_dev = mean(une_life,na.rm = T)) %>% 
  knitr::kable(digits = 3)


data %>% 
  janitor::clean_names() %>% 
  group_by(developed_developing_countries) %>% 
  ggplot(aes(x = developed_developing_countries, y = une_life,fill = developed_developing_countries)) +
  geom_boxplot() +
  labs(title = "Boxplot of Life Expectancy by Development Status") +
  xlab("Development Status") +
  ylab("Life Expectancy")

```

\ \par

  * The boxes of different development status are almost not overlapping with each other. 
  * The pattern is clear that people in developed countries tend to have a higher life expectancy.
  

$$H_0:  \sigma^2_{developing} =\  \sigma^2_{developed}\ \text { vs } \ H_1: \sigma^2_{developing} \neq\  \sigma^2_{developed} $$
 
 
  * We have performed variance test and conclude that the variances are not equal between the two categories. Since the method is similar to what we have used and displayed when studying the regional differences, we do not show the process here.
  
  \ \par
$$H_0:  \text{mean life_exp}_{developing} = \ \text{mean life_exp}_{developed}\ \text { vs } \ H_1: \text{mean life_exp}_{developing} \neq \text{mean life_exp}_{developed} $$
  
  * We have also performed 2 sample t.test to compare the mean life expectancy between the two groups. We conclude that the means are not equal. Since the method is similar to what we have used and displayed when studying the regional differences, we do not show the process here.



\ \par
### Summary

In this part, we applied statistical analysis to studying the differences in life expectancy caused by various factors. We first examine the distribution features and then choose appropriate tests to perform.

We draw the following conclusions from the tests and plots result :

  * Life expectancy in Americas and Europe have significantly different means. 
  
  * Europe has the highest mean life expectancy in the world.
  
  * Africa has the lowest life expectancy in the world.
  
  * Western Pacific and South-East Asia has approximately the same proportion of life expectancy over 65.
  
  * Average life expectancy are significantly different among income groups and development status. People with higher income and from more developed countries tend to live longer.




\ \par
### Linear Model

## Discussion