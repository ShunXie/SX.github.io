---
title: Analysis
author: "Jingyi Yao"
date: "`r Sys.Date()`"
output: github_document
---

```{r,message=FALSE,warning=FALSE}
library(tidyverse)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


\ \par
```{r,message=FALSE}
data = read_csv("./data/Merged_expectation.csv")

```



\ \par
## 1.  Life Expectation by Regions

```{r}
data %>% 
  janitor::clean_names() %>% 
  group_by(region) %>% 
  summarise(avg_by_region = mean(une_life,na.rm = T)) %>% 
  arrange(avg_by_region) %>% 
  knitr::kable(digits = 3)
```

\ \par

  * The table shows the arranged average life expectancy of each region from 2000 to 2016. 
  
  * The range of average life expectancy among regions is about 8 years. 
  
  * Europe has the highest average life expectancy while Africa has the lowest.


\ \par
```{r}
data %>% 
  janitor::clean_names() %>% 
  group_by(region) %>% 
  ggplot(aes(x = fct_reorder(region,une_life), y = une_life, fill = region)) +
  geom_boxplot() +
  labs(title = "Boxplot of Life Expectancy by Regions") +
  xlab("Region") +
  ylab("Life Expectancy") + 
  theme(axis.text.x = element_text(hjust = 1, angle = 10,size = 8))
  
        
```

\ \par

  * The boxplot shows the distribution of life expectancy in each region.
  
  * The variance of life expectancy is higher in Eastern Mediterranean and Africa.
  
  * The Americas has many outliers with low life expectancy
  
  * We can roughly tell from the plot that the variances of life expectancy among regions are not equal. Thus, we may perform a statistical test to check heteroscedasticity






\ \par
#### test of equal variance
```{r}
bartlett.test(une_life ~ factor(region),data = data) %>% 
  broom::tidy() %>% 
  knitr::kable()

```


\ \par
The null hypothesis for Bartlett test is that the variances are equal. The
result shows that the p-value is less than 0.05. Thus, we may reject the null and conclude that the variances of life expectancy among different regions is not equal.
Consequently, we cannot perform ANOVA to test the difference in mean life expectancy. We should perform t.test with unknown unequal variances instead.




\ \par
## 2. t.test : Compare Mean Life Expectancy Between Americas and Europe

\ \par
From the boxplot above, we find that the life expectancy in Americas and Europe distribute almost in the same interval. Though the median of Europe is higher, the variance in Americas seems smaller. Thus, we want to study if the mean life expectancy in the two regions are significantly different.


\ \par
#### extract life expectancy in Americas and Europe
```{r}
Americas <- data %>% 
  janitor::clean_names() %>% 
  filter(region == "Americas") %>% 
  pull(une_life)


Europe <- data %>% 
  janitor::clean_names() %>% 
  filter(region == "Europe") %>% 
  pull(une_life) 

```


#### test equal variance
```{r}
var.test(Americas,Europe,alternative = "two.sided",conf.level = 0.95) %>% 
  broom::tidy() %>% 
  knitr::kable()

```


#### t.test with unknown unequal variances

```{r}
t.test(Americas,Europe,alternative = "less",conf.level = 0.95,paired = F,var.equal = FALSE ) %>% 
  broom::tidy() %>% 
  knitr::kable()

```



\ \par
## 3. prop.test : Compare the Proportion of Life Expectancy Over 70 Between Western Pacific and South-East Asia


```{r}
data %>% 
  janitor::clean_names() %>% 
  filter(region == "Western Pacific") %>% 
  summarise(above_65 = sum(une_life > 65),
            total = n()) %>% 
  knitr::kable()


data %>% 
  janitor::clean_names() %>% 
  filter(region == "South-East Asia")  %>% 
  summarise(above_65 = sum(une_life > 65),
            total = n()) %>% 
  knitr::kable()

prop.test(c(304,149),n = c(357,187),correct = F) %>% 
  broom::tidy() %>% 
  knitr::kable()

```




\ \par
## 4. Average Life Expectancy by (region, year) Combination

```{r}
data %>% 
  janitor::clean_names() %>% 
  group_by(region,year) %>% 
  summarise(avg_by_year_region = mean(une_life,na.rm = T)) %>% 
  pivot_wider(
    names_from = region,
    values_from = avg_by_year_region
  ) %>% 
  knitr::kable(digits = 3)


```


\ \par
## 5. Life Expectancy by Income Level

```{r}
data %>% 
  janitor::clean_names()  %>% 
  filter(!is.na(income_group)) %>%  
  group_by(income_group) %>% 
  summarise(avg_by_income = mean(une_life,na.rm = T)) %>% 
  arrange(avg_by_income) %>% 
  knitr::kable(digits = 3)

data %>% 
  janitor::clean_names() %>% 
  filter(!is.na(income_group)) %>% 
  group_by(income_group) %>% 
  ggplot(aes(x = fct_reorder(income_group,une_life), y = une_life,fill = income_group)) +
  geom_boxplot() +
  labs(title = "Boxplot of Life Expectancy by Income Groups") +
  xlab("Income Groups") +
  ylab("Life Expectancy")
  

```





\ \par
## 6. Life Expectancy by Development Status

```{r}
data %>% 
  janitor::clean_names() %>% 
  group_by(developed_developing_countries) %>% 
  summarise(avg_by_dev = mean(une_life,na.rm = T)) %>% 
  knitr::kable(digits = 3)


data %>% 
  janitor::clean_names() %>% 
  group_by(developed_developing_countries) %>% 
  ggplot(aes(x = developed_developing_countries, y = une_life,fill = developed_developing_countries)) +
  geom_boxplot() +
  labs(title = "Boxplot of Life Expectancy by Development Status") +
  xlab("Development Status") +
  ylab("Life Expectancy")

```


\ \par
## 7. t.test : Comapre Mean Life Expectancy Between Developed and Developing Countries

#### extract developed and developing life expectancy
```{r}
developing <- data %>% 
  janitor::clean_names() %>% 
  filter(developed_developing_countries == "Developing") %>% 
  pull(une_life)


developed <- data %>% 
  janitor::clean_names() %>% 
  filter(developed_developing_countries == "Developed") %>% 
  pull(une_life) 

```


#### test equal variance
```{r}
var.test(developing,developed,alternative = "two.sided",conf.level = 0.95) %>% 
  broom::tidy() %>% 
  knitr::kable()

```


#### t.test with unknown unequal variances

```{r}
t.test(developing,developed,alternative = "less",conf.level = 0.95,paired = F,var.equal = FALSE ) %>% 
  broom::tidy() %>% 
  knitr::kable()

```





